name: C/C++ CI

on: workflow_dispatch

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: pwd
      run: pwd
    - name: docker [pull a build image]
      run: docker pull ghcr.io/vookimedlo/ubuntu-qt:qt6_latestdistroofficial_gcc_kinetic
    - name: docker [run a container]
      run: docker run -d --name linux_docker --rm -ti ghcr.io/vookimedlo/ubuntu-qt:qt6_latestdistroofficial_gcc_kinetic bash
    - name: docker [copy sources]
      run: |
        docker exec linux_docker mkdir -p /root/sources/vooki-image-viewer
        docker cp -L ./ linux_docker:/root/sources/vooki-image-viewer
    - name: docker [build sources]
      run: |
        docker exec linux_docker ls -la /root/sources/vooki-image-viewer
        docker exec linux_docker bash -c 'source /etc/profile && cd /root/sources/ && cmake -DCMAKE_BUILD_TYPE=Release -H. -Bbuild vooki-image-viewer/build/cmake && cmake --build build --config Release --target package'
        docker exec linux_docker ls -la /root/sources/
        docker exec linux_docker ls -la /root/sources/build
        docker exec linux_docker 'tar -cf - /root/sources/build/*.deb' | tar -xvf -
        ls -la
 #   - name: docker [collect artifacts]
 #     run: docker exec linux_docker bash -c 'cd /root/sources/build/ && ls -l && tar -cf *.deb' | tar -xvf -
    - name: archive artifacts
      uses: actions/upload-artifact@v3
      with:
        name: kinetic-deb
        path: |
          *.deb
    - name: docker stop
      run: docker stop linux_docker
